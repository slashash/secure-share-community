/*!
 Form Repeat
 Version: 2.0.1
 (c) 2024 Wappler.io
 @build 2024-07-02 16:35:08
 */
dmx.Component("form-repeat",{initialData:{canAdd:!0,items:[]},attributes:{items:{type:[Array,Number],default:0},min:{type:Number,default:0},max:{type:Number,default:1/0},sortable:{type:Boolean,default:!1},handle:{type:String,default:null},animation:{type:Number,default:0}},methods:{add(){this._add()},remove(e){this._remove(e)},move(e,t){this._mode(e,t,!0)},moveToStart(e){this._move(e,0,!0)},moveToEnd(e){this._move(e,this.children.length-1,!0)},moveBefore(e){this._move(e,e-1,!0)},moveAfter(e){this._move(e,e+1,!0)},duplicate(e){this._duplicate(e)},reset(){this._render()}},render(e){this._template=this._templateFromChildren(e);this._template.querySelectorAll("input[name], select[name], textarea[name]").forEach((e=>{const t=e.name.indexOf("[");t>0?e.setAttribute("dmx-bind:name",this.name+"[{{$formindex}}]["+e.name.slice(0,t)+"]"+e.name.slice(t)):e.setAttribute("dmx-bind:name",this.name+"[{{$formindex}}]["+e.name+"]")})),this.props.sortable&&(this._sortable=Sortable.create(e,{handle:this.props.handle,onEnd:e=>this._move(e.oldIndex,e.newIndex)})),this._render(),this._refresh()},performUpdate(e){e.has("items")&&this._render(),e.has("sortable")&&(this._sortable?this._sortable.option("disabled",!this.props.sortable):this._sortable=Sortable.create(node,{handle:this.props.handle,onEnd:e=>this._move(e.oldIndex,e.newIndex)})),e.has("handle")&&this._sortable&&this._sortable.option("handle",this.props.handle),e.has("animation")&&this._sortable&&this._sortable.option("animation",this.props.animation),this._refresh()},_render(){const e=dmx.repeatItems("string"==typeof this.props.items?Number(this.props.items):this.props.items);e.length<this.props.min&&(e.length=this.props.min),e.length>this.props.max&&(e.length=this.props.max),this._clear();for(let t=0;t<e.length;t++)this._add(e[t])},_duplicate(e){this._add(),this._move(this.children.length-1,e+1,!0);let t=[];this.children[e].$nodes.forEach((e=>{1==e.nodeType&&t.push(...Array.from(e.querySelectorAll("input[name], textarea[name], select[name]")))}));let i=[];if(this.children[e+1].$nodes.forEach((e=>{1==e.nodeType&&i.push(...Array.from(e.querySelectorAll("input[name], textarea[name], select[name]")))})),t.length==i.length)for(let e=0;e<t.length;e++){const s=t[e],n=i[e];if(s.tagName!=n.tagName)break;if("TEXTAREA"==s.tagName)n.value=s.value;else if("INPUT"==s.tagName){if("file"==s.type||"password"==s.type)continue;"checkbox"==s.type||"radio"==s.type?n.checked=s.checked:n.value=s.value}else if("SELECT"==s.tagName)if(s.multiple)for(const e of s.selectedOptions)for(const t of n.options)e.value==t.value&&(t.selected=!0);else n.value=s.value;n.dispatchEvent(new Event("change"))}},_add(e={}){if(this.children.length>=this.props.max)return;const t=new(dmx.Component("repeat-item"))(this._template.cloneNode(!0),this,e);t.$nodes.forEach((e=>{this.$node.appendChild(e),t.$parse(e)})),this.children.push(t),this._refresh()},_remove(e){this.children.length<=this.props.min||(this.children.splice(e,1).forEach((e=>{e.$destroy()})),this._refresh())},_refresh(){this.children.forEach(((e,t)=>{e.set({$index:t,$formindex:t,$canRemove:this.children.length>this.props.min,$canMoveToStart:t>0,$canMoveBefore:t>0,$canMoveAfter:t<this.children.length-1,$canMoveToEnd:t<this.children.length-1})})),this.set("canAdd",this.children.length<this.props.max),this.set("items",this.children.map((e=>e.data)))},_clear(){this.children.splice(0).forEach((e=>{e.$destroy()})),this.$node.innerHTML=""},_move(e,t,i){e<0||e>=this.children.length||t<0||t>=this.children.length||(this.children.splice(t,0,this.children.splice(e,1)[0]),i&&(this.$node.innerHTML="",this.children.forEach((e=>{e.$nodes.forEach((e=>{this.$node.appendChild(e)}))}))),this._refresh())},_templateFromChildren(e){const t=document.createDocumentFragment();for(;e.hasChildNodes();)t.appendChild(e.firstChild);return t}});
//# sourceMappingURL=dmxFormRepeat.js.map
